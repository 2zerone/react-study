<!DOCTYPE html>
<html lang="en">
<head>
    <title>Document</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="http://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        class App extends React.Component {
            constructor(props) {
                super(props)

                //지난 설정 불러오기
                this.state = this.load()
            }

            save() {
                localStorage.state = JSON.stringify(this.state)
            }
            load() {
                let output
                try {output = JSON.parse(localStorage.state) //state 전체 속성 읽어들임
            } catch (e) {}

            if(output !== undefined && output.keyCount !== undefined && output.currentValue !== undefined) // 속성이 제대로 존재하는지 확인
            { 
                output = JSON.parse(localStorage.state)
            } else {
                output = { // 속성이 없거나 제대로 되어 있지 않을 경우 초기값 할당
                    keyCount: 0, currentValue: '', todos: []
                }
            }
            return output
        }

        componentDidUpdate() {
            this.save()
        }   

        render() {
            return <div>
                <h1>할 일 목록</h1>
                <input
                    value = {this.state.currentValue}
                    onChange = {this.textChange}
                    onKeyDown = {this.textKeyDown} />
                    <button onClick = {this.buttonClick}>할 일 추가하기</button>
                    <div>
                        {this.state.todos.map((todo) => { //todos.map() 메소드를 활용한 컴포넌트 배열 생성
                            return <TodoItem
                                dataKey = {todo.key}
                                isDone = {todo.isDone}
                                text = {todo.text}
                                removeItem = {this.removeItem}
                                changeCheckData = {this.changeCheckData} />  
                        })}
                    </div>
                </div>
        }

        // 각각 이벤트 연결 (바인딩 포함)

        const container = document.getElementById('root')
        ReactDOM.render(<App />, container)
    </script>
</body>

</html>